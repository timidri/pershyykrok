---
import { client } from "../lib/sanity";
import { PortableText } from "@portabletext/react";
import type { HomePageQueryResult } from "../sanity-types";
// Import the query
import { homePageQuery } from "../queries";

// Use the imported query
const data = await client.fetch<HomePageQueryResult>(homePageQuery);

if (!data) return Astro.redirect('/404');
---

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>{data.title}</title>
    <style>
      /* Simple CSS to match your mockup structure */
      .container { max-width: 900px; margin: 0 auto; padding: 2rem; font-family: serif; color: #333; }
      h1 { text-align: center; font-size: 2.5rem; margin-bottom: 2rem; }
      
      /* The Meeting Section Layout */
      .meeting-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* Split 50/50 */
        gap: 2rem;
        margin-top: 3rem;
        align-items: start;
      }
      
      .label { font-weight: bold; margin-right: 0.5rem; }
      .detail-row { margin-bottom: 0.8rem; }
      
      /* Mobile responsiveness */
      @media (max-width: 768px) {
        .meeting-grid { grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="intro">
		{data.introText && (
         <PortableText value={data.introText} />
		)}
      </div>

      {data.meetingSection && (
        <div class="meeting-grid">
          <div class="info-col">
            <h3>{data.meetingSection.sectionTitle}</h3>
            
            <div class="detail-row">
              <span class="label">Когда:</span>
              {data.meetingSection.time}
            </div>
            
            <div class="detail-row">
              <span class="label">Где:</span>
              {data.meetingSection.address}
            </div>

            <div class="detail-row">
              <span class="label">Языки:</span>
              {data.meetingSection.languages}
            </div>

            <div class="detail-row">
              <span class="label">Телефон:</span>
              <a href={`tel:${data.meetingSection.phone}`}>{data.meetingSection.phone}</a>
            </div>
          </div>

          <div class="map-col">
             <div style="background: #eee; height: 300px; display: flex; align-items: center; justify-content: center;">
                Map Coordinate: <br/>
                Lat: {data.meetingSection.mapLocation?.lat} <br/>
                Lng: {data.meetingSection.mapLocation?.lng}
             </div>
          </div>
        </div>
      )}
    </div>
  </body>
</html>