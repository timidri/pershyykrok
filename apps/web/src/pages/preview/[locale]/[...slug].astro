---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import PageContent from '../../../components/PageContent.astro';
import { fetchPageBySlugData } from '../../../lib/content';
import { assertLocaleOrRedirect } from '../../../lib/locale';
import { requirePreview } from '../../../lib/preview';

export const prerender = false;

const { locale, slug } = Astro.params as { locale: string; slug: string | undefined };

const localeValue = assertLocaleOrRedirect(locale, Astro.redirect);
requirePreview(Astro);

const slugStr = slug ?? '';
if (!slugStr) return Astro.redirect(`/${localeValue}`);

const data = await fetchPageBySlugData({ locale: localeValue, slug: slugStr, preview: true });

if (!data) return Astro.redirect('/404');
---

<BaseLayout
  title={data.title ?? 'Page'}
  locale={localeValue}
  currentPath={`/${localeValue}/${slugStr}`}
  isPreview={true}
>
  <PageContent data={data} />
</BaseLayout>
